# Load librery and RData
library("measuRing")
library("dplR")
library("tidyr")
## library("dplyr")
library('DendroSync')
options(width=163) # R console wide lenght
options(width=180)
# sample folder
dir()
setwd('~/Documents/dendro/smart-images/')
dir()
dir(pattern='RData')
# carga del entorno de trabajo
load(file='allRings.RData')
# listado de muestras y parametros de la funcion autodetect
# eleccion de ficheros a analizar
## series.name <- ''
## (v.nam <- dir()[ grep( series.name, dir( pattern='*.tif') ) ] )
(v.nam <- dir( pattern='*.tif') )
## write(v.nam, file='names_f.csv')
# variables para la función multidetect
LastYear  = 2021 # año del último anillo; se puede poner en una lista si no son el mismo para todos
Segs      = 1 # número de segmentos
Origin    = 0.01 # sensibilidad en la detección de la MG
AutoDet   = TRUE # se puede poner en una lista
Darker    = F  # true for finding negative extremes (quercus for example)
ColMarker = 'red'
Plot      = TRUE # mostrar gráfico para incluir o eliminar anillos
##                START the analysis // iniciar el analisis
# all.rings <- NULL
img  <- v.nam
## analizamos todas las muestras del directorio de golpe
(img <- v.nam[c(5,6)]) # elegimos algunas
AutoDet    <- F
## deteccion automatica
ToInc      <- NULL
(n.all.ring <- names(all.rings))
## comprobamos la muestra en la que nos llegamos
v.nam # muestras en el listado
(img0 <- setdiff(v.nam, n.all.ring))
img <- img0
(img <- v.nam[c(2:6)]) # elegimos algunas
names(all.rings) # comprobamos la muestra en la que nos llegamos
## (img <- v.nam[c(14,22)]) # y elegimos las muestras
## (img <- v.nam[c(1)]) # y elegimos las muestras
j<-5
(img <- v.nam[j]) # y elegimos las muestras
AutoDet    <- F # deteccion automatica
ToInc      <- NULL
RE-ANALISIS DE MUESTRAS PARA CROSSDATING CON multiDetect-------#
X11.options(width = 148, height = 6, xpos = 0, pointsize = 10) # ajustar el tamaño de la ventana grafica
d.ring <- NULL
Segs <- 1
d.ring <- multiDetect(img,                   # lista de imagenes a analizar
last.yr    = LastYear,  # año del último anillo;
## se puede poner en una lista si no son el mismo para todos
segs       = Segs,      # número de segmentos
origin     = Origin,    # 0.01, # sensibilidad en la detección de la MG
auto.det   = AutoDet,   # se puede poner en una lista
inclu = list(c(ToInc)), # Lista de anillos seleccionados originalmente
darker     = Darker,    # true for finding negative extremes (quercus for example)
col.marker = ColMarker,
plot       = Plot)
